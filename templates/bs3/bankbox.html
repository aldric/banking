<script type="text/javascript">
    jQuery(function() {
        <?php include(__ROOT__ .'/components/star-rating.js') ?>

        var boxes = new Vue({
            el: '#bank-box',
            data: {
                bankBoxes: bankBoxes
            },
            components: {
                'star-rating': starRatingComponent
            },
            computed: {
                rowClass: function() {
                    return this.bankBoxes.banks.length > 0 ? 'row' : '';
                },
                banks: function() {
                    return this.bankBoxes.banks;
                }
            },
            methods: {
                getBankClass: function(bankName) {
                    return 'b-box-' + bankName.trim().toLowerCase().replace(' ', '-');
                },
                realOffer: function(offer) {
                    var realOffer = [];
                    for (var i in offer) {
                        if (offer[i] == '1')
                            realOffer.push(i);
                    }
                    return realOffer;
                },
                mobileApps: function(bank) {
                    var mobileApps = [];
                    for (var i in bank.mobile_apps) {
                        if (bank.mobile_apps[i] === true) {
                            var app = '';
                            if (i == 'iOS')
                                app = 'fa fa-apple fa-2x apple-grey';
                            else if (i == 'Android')
                                app = 'fa fa-android fa-2x android-green';
                            else if (i == 'Windows')
                                app = 'fa fa-windows fa-2x windows-purple';
                            mobileApps.push(app);
                        }
                    }
                    return mobileApps;
                },
                notes: function(bank) {
                    var notes = [];
                    var notesToDisplay = this.bankBoxes.notes;
                    var icons = this.bankBoxes.icons;
                    notesToDisplay.forEach(function(el, i) {
                        var idx = parseInt(el);
                        if (bank.eval_data[idx] !== undefined) {
                            var found = bank.eval_data[idx];
                            notes.push({
                                label: found.label,
                                description: found.description,
                                note: found.note,
                                icon: i < icons.length ? 'fa ' + icons[i] + ' ' : ''
                            });
                        }
                    });
                    return notes;
                },
                getNote: function(note) {
                    var n = (note / 10);
                    return (Math.round(n) == n ? n : n.toFixed(1)) + '/10';
                }
            }
        });
    });
</script>
<?php include(__ROOT__ .'/components/star-rating.html') ?>

<div id="bank-box">
    <div v-bind:class="rowClass">
        <div v-for="bank in banks" :class="bankBoxes.colCss">
            <div :class="getBankClass(bank.name)" class="card-container">
                <div class="card">
                    <div class="front">
                        <div class="cover" style="">
                            <img :src="bank.image" class="img-box" />
                        </div>
                        <div class="content">
                            <div class="main">
                                <div class="box-offer"><i class="fa fa-gift" aria-hidden="true"></i>{{ bank.welcome_offer }}</span>
                                </div>
                                <div class="box-offer"><i class="fa fa-credit-card" aria-hidden="true"></i>{{ bank.credit_card }}</span>
                                </div>
                                <div class="box-offer"><i class="fa fa-check" aria-hidden="true"></i>{{ bank.pros[0] }}</span>
                                </div>
                            </div>
                            <div class="footer">
                                <i class="fa fa-mail-forward"></i> {{bank.name}}
                            </div>
                        </div>
                    </div>
                    <!-- end front panel -->
                    <div class="back">
                        <div class="header">
                            <div class="ratings" style="height: 20px;">
                                <star-rating :percentage="bank.mean" v-show="bank.mean"></star-rating>
                            </div>
                            <img :src="bank.favicon" class="motto-icon" />
                            <h5 class="motto motto-note" style="text-align: center;" v-html="getNote(bank.mean)"></h5>
                        </div>
                        <div class="content">
                            <div class="main">
                                <h4 class="text-center"> {{bank.name}} </h4>
                                <table class="table table-condensed" style="margin-bottom: 5px;">
                                    <tbody>
                                        <tr v-for="note in notes(bank)">
                                            <td>{{ note.label }}</td>
                                            <td>
                                                <star-rating :percentage="note.note"></star-rating>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                <div class="col-md-12 text-center">
                                    <i v-for="app in mobileApps(bank)" :class="app"></i>
                                </div>
                            </div>
                        </div>
                        <div class="footer">
                            <div class="social-links text-center">
                                <a v-bind:href="bank.review_link" class="facebook"><i class="fa fa-info-circle fa-fw"></i>Voir la revue</a>
                                <a v-bind:href="bank.affiliate_link" target="_blank" rel="nofollow" class="google"><i class="fa fa-external-link fa-fw"></i>Visiter le site</a>
                            </div>
                        </div>
                    </div>
                    <!-- end back panel -->
                </div>
                <!-- end card -->
            </div>
            <!-- end card-container -->
        </div>
    </div>
</div>
